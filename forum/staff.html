<span style='font-family: "Bravura Text BB"; font-size: 280%;' class="staff unprocessed {TEXT}">{TEXT2}</span>
<script type='text/javascript'>
    (() => {
        const CLEF_AGNOSTIC_UNICODE_MAP = {
            "sp2": " ",         // U+2003   EM SPACE
            "sp1": " ",         // U+2002   EN SPACE
            "sp0.5": " ",       // U+2005   FOUR-PER-EM SPACE
            "sp0.25": "",       // U+2009   THIN SPACE
            "sp0.125": "",      // U+200A   HAIR SPACE
            "nbsp1": "",        // U+2007   FIGURE SPACE
            "nbsp0.5": " ",     // U+00A0   NO-BREAK SPACE [NBSP]
            "nbsp0.25": " ",    // U+202F   NARROW NO-BREAK SPACE [NNBSP]

            "ln3": "",
            "ln2": "",
            "ln1": "",

            "leger": "",

            "tclef": "",
            "aclef": "",
            "bclef": "",

            "1note": "",
            "1notedown": "",
            "2note": "",
            "2notedown": "",
            "4note": "",
            "4notedown": "",
            "8note": "",
            "8notedown": "",

            "h": "",
            "#": "",
            "b": "",
            "x": "",
            "bb": "",

            "|(": "",
            "!(": "",
            "/|": "",
            "\\!": "",
            "|)": "",
            "!)": "",
            "//|": "",
            "\\\\!": "",
            "/|)": "",
            "\\!)": "",
            "/|\\": "",
            "\\!/": "",
            "(|)": "",
            "(!)": "",
            "(|\\": "",
            "(!/": "",

            ")||(": "",
            ")!!(": "",
            "||)": "",
            "!!)": "",
            "||\\": "",
            "!!/": "",
            "/||)": "",
            "\\!!)": "",
            "/||\\": "",
            "\\!!/": "",
            "|||(": "",
            "!!!(": "",
            "/|||": "",
            "\\!!!": "",
            "|||)": "",
            "!!!)": "",
            "//|||": "",
            "\\\\!!!": "",
            "/|||)": "",
            "\\!!!)": "",
            "/|||\\": "",
            "\\!!!/": "",
            "(|||)": "",
            "(!!!)": "",
            "(|||\\": "",
            "(!!!/": "",
            ")X(": "",
            ")Y(": "",
            "X)": "",
            "Y)": "",
            "X\\": "",
            "Y/": "",
            "/X)": "",
            "\\Y)": "",
            "/X\\": "",
            "\\Y/": "",

            ")|(": "",
            ")!(": "",
            "~|(": "",
            "~!(": "",
            "|\\": "",
            "!/": "",
            "(|": "",
            "(!": "",
            "(|(": "",
            "(!(": "",
            "~||(": "",
            "~!!(": "",
            ")||~": "",
            ")!!~": "",
            "/||": "",
            "\\!!": "",
            "(||(": "",
            "(!!(": "",
            "//||": "",
            "\\\\!!": "",
            ")|||(": "",
            ")!!!(": "",
            "~|||(": "",
            "~!!!(": "",
            "|||\\": "",
            "!!!/": "",
            "(|||": "",
            "(!!!": "",
            "(|||(": "",
            "(!!!(": "",
            "~X(": "",
            "~Y(": "",
            ")X~": "",
            ")Y~": "",
            "/X": "",
            "\\Y": "",
            "(X(": "",
            "(Y(": "",
            "//X": "",
            "\\\\Y": "",

            "|~": "",
            "!~": "",
            ")/|": "",
            ")\\!": "",
            "/|~": "",
            "\\!~": "",
            "||~": "",
            "!!~": "",
            ")||)": "",
            ")!!)": "",
            "/||~": "",
            "\\!!~": "",
            "|||~": "",
            "!!!~": "",
            ")/|||": "",
            ")\\!!!": "",
            "/|||~": "",
            "\\!!!~": "",
            "X~": "",
            "Y~": "",
            ")X)": "",
            ")Y)": "",
            "/X~": "",
            "\\Y~": "",

            ")|": "",
            ")!": "",
            "~|": "",
            "~!": "",
            ")~|": "",
            ")~!": "",
            "~~|": "",
            "~~!": "",
            ")|~": "",
            ")!~": "",
            ")|)": "",
            ")!)": "",
            "~|)": "",
            "~!)": "",
            "~|\\": "",
            "~!/": "",
            ")//|": "",
            ")\\\\!": "",
            "(|~": "",
            "(!~": "",
            "(/|": "",
            "(\\!": "",
            ")/|\\": "",
            ")\\!/": "",
            "|\\)": "",
            "!/)": "",
            "|\\\\": "",
            "!//": "",
            ")|\\\\": "",
            ")!//": "",

            ")~||": "",
            ")~!!": "",
            "~~||": "",
            "~~!!": "",
            ")/||": "",
            ")\\!!": "",
            "(||": "",
            "(!!": "",
            "~||)": "",
            "~!!)": "",
            "~||\\": "",
            "~!!/": "",
            ")//||": "",
            ")\\\\!!": "",
            "(||~": "",
            "(!!~": "",
            ")|||": "",
            ")!!!": "",
            "~|||": "",
            "~!!!": "",
            ")~|||": "",
            ")~!!!": "",
            "~~|||": "",
            "~~!!!": "",
            ")|||~": "",
            ")!!!~": "",
            ")|||)": "",
            ")!!!)": "",
            "~|||)": "",
            "~!!!)": "",
            "~|||\\": "",
            "~!!!/": "",
            ")//|||": "",
            ")\\\\!!!": "",
            "(|||~": "",
            "(!!!~": "",
            "(/|||": "",
            "(\\!!!": "",
            ")/|||\\": "",
            ")\\!!!/": "",
            "|||\\)": "",
            "!!!/)": "",
            "|||\\\\": "",
            "!!!//": "",
            ")|||\\\\": "",
            ")!!!//": "",
            ")~X": "",
            ")~Y": "",
            "~~X": "",
            "~~Y": "",
            ")/X": "",
            ")\\Y": "",
            "(X": "",
            "(Y": "",
            "~X)": "",
            "~Y)": "",
            "~X\\": "",
            "~Y/": "",
            ")//X": "",
            ")\\\\Y": "",
            "(X~": "",
            "(Y~": "",

            "|": "",
            "!": "",
            "'": "",
            ".": "",

            "`": "",
            ",": "",
            "``": "",
            ",,": "",

            "@1": "",
            "l1": "",
            "@2": "",
            "l2": "",
            "@3": "",
            "l3": "",
            "@4": "",
            "l4": "",
            "@5": "",
            "l5": "",
            "@6": "",
            "l6": "",
            "@7": "",
            "l7": "",
            "@8": "",
            "l8": "",
            "@9": "",
            "l9": "",
            "@.": "",
            "l.": "",
        }

        const TREBLE_COMBINING_STAFF_POSITION_UNICODE_MAP = {
            "c6": "",          // U+EB97   staffPosRaise8
            "b5": "",          // U+EB96   staffPosRaise7
            "a5": "",          // U+EB95   staffPosRaise6
            "g5": "",          // U+EB94   staffPosRaise5
            "f5": "",          // U+EB93   staffPosRaise4
            "e5": "",          // U+EB92   staffPosRaise3
            "d5": "",          // U+EB91   staffPosRaise2
            "c5": "",          // U+EB90   staffPosRaise1
            "b4": "",          // N/A
            "a4": "",          // U+EB98   staffPosLower1
            "g4": "",          // U+EB99   staffPosLower2
            "f4": "",          // U+EB9A   staffPosLower3
            "e4": "",          // U+EB9B   staffPosLower4
            "d4": "",          // U+EB9C   staffPosLower5
            "c4": "",          // U+EB9D   staffPosLower6
            "b3": "",          // U+EB9E   staffPosLower7
            "a3": "",          // U+EB9F   staffPosLower8
        }

        const BASS_COMBINING_STAFF_POSITION_UNICODE_MAP = {
            "e4": "",          // U+EB97   staffPosRaise8
            "d4": "",          // U+EB96   staffPosRaise7
            "c4": "",          // U+EB95   staffPosRaise6
            "b3": "",          // U+EB94   staffPosRaise5
            "a3": "",          // U+EB93   staffPosRaise4
            "g3": "",          // U+EB92   staffPosRaise3
            "f3": "",          // U+EB91   staffPosRaise2
            "e3": "",          // U+EB90   staffPosRaise1
            "d3": "",          // N/A
            "c3": "",          // U+EB98   staffPosLower1
            "b2": "",          // U+EB99   staffPosLower2
            "a2": "",          // U+EB9A   staffPosLower3
            "g2": "",          // U+EB9B   staffPosLower4
            "f2": "",          // U+EB9C   staffPosLower5
            "e2": "",          // U+EB9D   staffPosLower6
            "d2": "",          // U+EB9E   staffPosLower7
            "c2": "",          // U+EB9F   staffPosLower8
        }

        const unicodeFromCode = userInput =>
            String.fromCharCode(parseInt(userInput.replace(/^u\+(.*)/, "0x$1")))

        const getUnicode = (userInput, clef) => {
            const CLEF_UNICODE_MAP = clef === "bass" ?
                BASS_COMBINING_STAFF_POSITION_UNICODE_MAP :
                TREBLE_COMBINING_STAFF_POSITION_UNICODE_MAP

            const INPUT_TO_UNICODE_MAP = {
                ...CLEF_AGNOSTIC_UNICODE_MAP,
                ...CLEF_UNICODE_MAP,
            }

            return INPUT_TO_UNICODE_MAP[userInput]
        }

        document.querySelectorAll("span.staff.unprocessed").forEach(staffSpan => {
            const clef = staffSpan.classList[2]

            staffSpan.classList.remove("unprocessed")

            const clefStuff = clef === "bass" ? "ln3 bclef ln3 sp2" :
                clef === "treble" ? "ln3 tclef ln3 sp2" : ""

            staffSpan.textContent = `${clefStuff}${staffSpan.textContent}`
                .toLowerCase()
                .replace(/<br>/g, " ")
                .replace(/\n/g, " ")
                .replace(/\t/g, " ")
                .split(" ")
                .map(userInput => {
                    const unicode = getUnicode(userInput, clef)

                    return unicode === undefined ?
                        userInput.match(/^u\+/) ?
                            unicodeFromCode(userInput) :
                            userInput :
                        unicode
                })
                .join("")
        })
    })()
</script>
