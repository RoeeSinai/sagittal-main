// TODO: really should have at least one integration test for this thing
